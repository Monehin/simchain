generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model EncryptedWallet {
  id            String         @id @default(cuid())
  encryptedSim  String
  simHash       String         @unique
  walletAddress String         @unique
  country       String         @default("RW")
  currentAlias  String         @default("unknown")
  lastBalance   Float?         @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  aliasHistory  AliasHistory[] @relation("WalletAliasHistory")

  @@map("encrypted_wallets")
}

model AliasHistory {
  id        String          @id @default(cuid())
  walletId  String
  oldAlias  String?
  newAlias  String
  changedAt DateTime        @default(now())
  wallet    EncryptedWallet @relation("WalletAliasHistory", fields: [walletId], references: [id], onDelete: Cascade)

  @@index([walletId])
  @@index([changedAt])
  @@map("alias_history")
}

model ErrorLog {
  id           String   @id @default(cuid())
  action       String
  alias        String?
  errorMessage String
  errorCode    String?
  metadata     Json?
  createdAt    DateTime @default(now())

  @@index([action])
  @@index([alias])
  @@index([errorCode])
  @@index([createdAt])
  @@map("error_logs")
}
